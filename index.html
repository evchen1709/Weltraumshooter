<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, user-scalable=no" />
  <title>Weltraum Shooter</title>
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0a0a2e" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
  <link rel="apple-touch-icon" href="icons/icon-192.svg" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <style>
    /* -- ORIGINAL DESIGN (1:1) + minimale Fixes f√ºr Mobile/PWA -- */
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    html, body { height: 100%; }
    body {
      margin: 0; padding: 0; overflow: hidden;
      background:
        radial-gradient(ellipse 800px 400px at 12% 20%, rgba(138, 43, 226, 0.6) 0%, rgba(75, 0, 130, 0.4) 30%, transparent 70%),
        radial-gradient(ellipse 600px 300px at 88% 10%, rgba(255, 20, 147, 0.5) 0%, rgba(199, 21, 133, 0.3) 25%, transparent 60%),
        radial-gradient(ellipse 900px 450px at 75% 90%, rgba(0, 191, 255, 0.45) 0%, rgba(30, 144, 255, 0.3) 35%, transparent 75%),
        radial-gradient(ellipse 700px 350px at 20% 80%, rgba(50, 205, 50, 0.4) 0%, rgba(34, 139, 34, 0.25) 30%, transparent 65%),
        radial-gradient(ellipse 1200px 600px at 50% 50%, rgba(72, 61, 139, 0.3) 0%, rgba(25, 25, 112, 0.2) 40%, transparent 80%),
        linear-gradient(135deg,
          #0a0a2e 0%, #1a0a3e 8%, #2a1a4e 16%, #1a2a5e 24%,
          #2a1a6e 32%, #0a1a4e 40%, #1a0a5e 48%, #2a2a6e 56%,
          #0a2a4e 64%, #1a1a5e 72%, #2a0a6e 80%, #0a0a4e 88%,
          #1a1a3e 96%, #0a0a2e 100%
        ),
        radial-gradient(circle at 30% 40%, rgba(72, 61, 139, 0.15) 0%, transparent 50%),
        radial-gradient(circle at 70% 60%, rgba(123, 104, 238, 0.1) 0%, transparent 40%);
      font-family: 'Orbitron', 'Courier New', monospace;
      image-rendering: -webkit-optimize-contrast;
      image-rendering: crisp-edges;
      backface-visibility: hidden; transform: translateZ(0);
    }
    .game-container { position: relative; width: 100vw; height: 100vh; overflow: hidden; }
    .cosmic-background { position: absolute; inset: 0;
      background:
        radial-gradient(circle at 15% 25%, rgba(138, 43, 226, 0.4) 0%, transparent 25%),
        radial-gradient(circle at 85% 15%, rgba(255, 20, 147, 0.3) 0%, transparent 30%),
        radial-gradient(circle at 70% 85%, rgba(0, 191, 255, 0.25) 0%, transparent 35%),
        radial-gradient(circle at 25% 75%, rgba(50, 205, 50, 0.2) 0%, transparent 40%);
      animation: nebula-drift 20s ease-in-out infinite alternate;
    }
    .moon { position: absolute; width: 280px; height: 280px; top: 8%; right: 12%; border-radius: 50%;
      background: radial-gradient(circle at 35% 25%, #f8f8f8, #e8e8e8 25%, #d5d5d5 50%, #c2c2c2 75%, #a8a8a8 100%);
      box-shadow: inset -25px -25px 60px rgba(0,0,0,.4), inset 15px 15px 40px rgba(255,255,255,.1),
                  0 0 80px rgba(255,255,255,.15), 0 0 120px rgba(255,255,255,.08);
      animation: moon-glow 8s ease-in-out infinite alternate;
    }
    .moon::before{content:''; position:absolute; inset:0; border-radius:50%;
      background:
        radial-gradient(circle at 25% 25%, transparent 12px, rgba(160,160,160,.5) 18px, transparent 24px),
        radial-gradient(circle at 60% 40%, transparent 8px, rgba(140,140,140,.4) 12px, transparent 18px),
        radial-gradient(circle at 45% 70%, transparent 10px, rgba(120,120,120,.5) 15px, transparent 22px),
        radial-gradient(circle at 75% 65%, transparent 6px, rgba(130,130,130,.4) 10px, transparent 15px),
        radial-gradient(circle at 35% 55%, transparent 5px, rgba(110,110,110,.5) 9px, transparent 14px),
        radial-gradient(circle at 15% 45%, transparent 3px, rgba(150,150,150,.3) 5px, transparent 8px),
        radial-gradient(circle at 85% 30%, transparent 4px, rgba(135,135,135,.4) 7px, transparent 11px),
        radial-gradient(circle at 55% 15%, transparent 2px, rgba(145,145,145,.3) 4px, transparent 7px),
        radial-gradient(circle at 70% 85%, transparent 3px, rgba(125,125,125,.4) 6px, transparent 9px),
        radial-gradient(circle at 20% 75%, transparent 2px, rgba(155,155,155,.3) 4px, transparent 6px),
        radial-gradient(ellipse 40px 8px at 40% 35%, rgba(100,100,100,.3), transparent),
        radial-gradient(ellipse 60px 12px at 65% 55%, rgba(90,90,90,.25), transparent),
        radial-gradient(ellipse 35px 6px at 25% 80%, rgba(105,105,105,.3), transparent);
    }
    @keyframes moon-glow { 0%{box-shadow:inset -20px -20px 40px rgba(0,0,0,.3), 0 0 50px rgba(255,255,255,.1)}
      100%{box-shadow:inset -20px -20px 40px rgba(0,0,0,.2), 0 0 80px rgba(255,255,255,.2)}}
    .stars-layer-1,.stars-layer-2,.distant-galaxies{ position:absolute; inset:0; }
    .stars-layer-1{ background-image:
      radial-gradient(4px 4px at 20px 30px, #fff, transparent),
      radial-gradient(3px 3px at 40px 70px, rgba(255,255,255,.95), transparent),
      radial-gradient(5px 5px at 90px 40px, rgba(173,216,230,1), transparent),
      radial-gradient(3px 3px at 130px 80px, rgba(255,255,255,.9), transparent),
      radial-gradient(4px 4px at 160px 30px, rgba(255,182,193,1), transparent),
      radial-gradient(3px 3px at 200px 90px, rgba(255,255,255,.95), transparent),
      radial-gradient(6px 6px at 250px 50px, rgba(138,43,226,.9), transparent),
      radial-gradient(4px 4px at 300px 120px, rgba(255,215,0,1), transparent),
      radial-gradient(3px 3px at 350px 40px, rgba(0,255,127,.9), transparent),
      radial-gradient(5px 5px at 380px 100px, rgba(255,69,0,.8), transparent),
      radial-gradient(2px 2px at 60px 15px, rgba(255,255,255,.8), transparent),
      radial-gradient(3px 3px at 120px 45px, rgba(135,206,250,.9), transparent),
      radial-gradient(2px 2px at 180px 75px, rgba(255,192,203,.7), transparent),
      radial-gradient(4px 4px at 240px 25px, rgba(255,255,0,.8), transparent),
      radial-gradient(2px 2px at 320px 65px, rgba(0,255,255,.7), transparent),
      radial-gradient(3px 3px at 360px 95px, rgba(255,20,147,.8), transparent),
      radial-gradient(5px 5px at 80px 110px, rgba(50,205,50,.7), transparent),
      radial-gradient(2px 2px at 140px 15px, rgba(255,255,255,.6), transparent),
      radial-gradient(3px 3px at 220px 105px, rgba(255,165,0,.8), transparent),
      radial-gradient(4px 4px at 280px 35px, rgba(147,112,219,.9), transparent);
      background-repeat: repeat; background-size: 400px 140px; animation: twinkle-bright 3s ease-in-out infinite alternate;
    }
    .stars-layer-2{ background-image:
      radial-gradient(1.5px 1.5px at 60px 20px, rgba(255,255,255,.7), transparent),
      radial-gradient(1px 1px at 120px 60px, rgba(255,255,255,.6), transparent),
      radial-gradient(1.5px 1.5px at 180px 100px, rgba(255,255,255,.5), transparent),
      radial-gradient(2px 2px at 240px 40px, rgba(135,206,250,.9), transparent),
      radial-gradient(1px 1px at 300px 80px, rgba(255,255,255,.4), transparent),
      radial-gradient(1px 1px at 30px 50px, rgba(255,255,255,.5), transparent),
      radial-gradient(1px 1px at 90px 25px, rgba(173,216,230,.6), transparent),
      radial-gradient(1px 1px at 150px 85px, rgba(255,255,255,.4), transparent),
      radial-gradient(1px 1px at 210px 15px, rgba(255,182,193,.5), transparent),
      radial-gradient(1px 1px at 270px 95px, rgba(255,255,255,.3), transparent),
      radial-gradient(1px 1px at 330px 35px, rgba(255,215,0,.6), transparent),
      radial-gradient(1px 1px at 390px 75px, rgba(255,255,255,.4), transparent),
      radial-gradient(1px 1px at 45px 105px, rgba(0,255,127,.5), transparent),
      radial-gradient(1px 1px at 105px 5px, rgba(255,255,255,.3), transparent),
      radial-gradient(1px 1px at 165px 45px, rgba(255,69,0,.4), transparent),
      radial-gradient(1px 1px at 225px 115px, rgba(255,255,255,.5), transparent),
      radial-gradient(1px 1px at 285px 55px, rgba(138,43,226,.6), transparent),
      radial-gradient(1px 1px at 345px 125px, rgba(255,255,255,.3), transparent),
      radial-gradient(1px 1px at 15px 85px, rgba(50,205,50,.4), transparent),
      radial-gradient(1px 1px at 75px 135px, rgba(255,255,255,.5), transparent);
      background-repeat: repeat; background-size: 400px 160px; animation: twinkle-soft 6s ease-in-out infinite alternate;
    }
    .distant-galaxies{ background-image:
      radial-gradient(ellipse 120px 30px at 25% 20%, rgba(147, 0, 211, 0.4), rgba(75, 0, 130, 0.2) 60%, transparent),
      radial-gradient(ellipse 90px 22px at 75% 30%, rgba(255, 69, 0, 0.35), rgba(255, 140, 0, 0.15) 50%, transparent),
      radial-gradient(ellipse 150px 38px at 60% 70%, rgba(0, 100, 200, 0.3), rgba(30, 144, 255, 0.1) 65%, transparent),
      radial-gradient(ellipse 105px 26px at 15% 80%, rgba(50, 205, 50, 0.25), rgba(34, 139, 34, 0.1) 55%, transparent),
      radial-gradient(ellipse 60px 15px at 85% 15%, rgba(255, 20, 147, 0.2), transparent),
      radial-gradient(ellipse 80px 20px at 10% 60%, rgba(138, 43, 226, 0.25), transparent),
      radial-gradient(ellipse 70px 18px at 90% 85%, rgba(255, 215, 0, 0.2), transparent),
      radial-gradient(ellipse 95px 24px at 40% 10%, rgba(0, 255, 127, 0.15), transparent),
      radial-gradient(ellipse 55px 14px at 65% 45%, rgba(255, 105, 180, 0.2), transparent),
      radial-gradient(ellipse 200px 8px at 25% 20%, rgba(147, 0, 211, 0.15), transparent),
      radial-gradient(ellipse 180px 6px at 75% 30%, rgba(255, 69, 0, 0.12), transparent),
      radial-gradient(ellipse 220px 10px at 60% 70%, rgba(0, 100, 200, 0.1), transparent);
      animation: galaxy-rotation 30s linear infinite;
    }
    @keyframes nebula-drift{0%{transform:translate(-10px,-5px) scale(1)}50%{transform:translate(5px,10px) scale(1.02)}100%{transform:translate(10px,-8px) scale(1.01)}}
    @keyframes twinkle-bright{0%{opacity:.7;transform:scale(1)}50%{opacity:1;transform:scale(1.1)}100%{opacity:.8;transform:scale(.95)}}
    @keyframes twinkle-soft{0%{opacity:.4}50%{opacity:.7}100%{opacity:.5}}
    @keyframes galaxy-rotation{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}

    .player{ position:absolute; bottom:50px; left:50%; transform:translateX(-50%); width:60px; height:60px; transition:left .1s ease; touch-action:none; }
    .enemy{ position:absolute; width:50px; height:50px; }
    .bullet,.enemy-bullet{ position:absolute; width:6px; height:20px; border-radius:3px; }
    .bullet{ background:linear-gradient(0deg,#00ff00 0%,#66ff66 30%,#ffffff 70%,#ccffcc 100%);
      box-shadow: 0 0 15px #00ff00, 0 0 25px rgba(0,255,0,.5), inset 0 0 5px rgba(255,255,255,.8);
      animation: bullet-pulse .3s ease-in-out infinite alternate;
    }
    .enemy-bullet{ background:linear-gradient(0deg,#ff0000 0%,#ff6666 30%,#ffffff 70%,#ffcccc 100%);
      box-shadow: 0 0 15px #ff0000, 0 0 25px rgba(255,0,0,.5), inset 0 0 5px rgba(255,255,255,.8);
      animation: bullet-pulse .3s ease-in-out infinite alternate;
    }
    @keyframes bullet-pulse{0%{transform:scale(1);filter:brightness(1)}100%{transform:scale(1.1);filter:brightness(1.3)}}

    .explosion{ position:absolute; width:80px; height:80px; border-radius:50%;
      background: radial-gradient(circle at 30% 30%, #ffffff 0%, #ffff88 15%, #ffaa00 35%, #ff6600 55%, #ff2200 75%, #cc0000 90%, transparent 100%);
      animation: explode 1s ease-out forwards; z-index:100; filter: brightness(1.5) contrast(1.2);
    }
    .explosion::before{content:'';position:absolute;width:140%;height:140%;top:-20%;left:-20%;border-radius:50%;
      background: radial-gradient(circle, transparent 20%, rgba(255,170,0,.8) 40%, rgba(255,102,0,.6) 60%, rgba(255,68,0,.4) 80%, transparent 100%);
      animation: explode-ring 1s ease-out forwards;
    }
    .explosion::after{content:'';position:absolute;width:180%;height:180%;top:-40%;left:-40%;border-radius:50%;
      background: radial-gradient(circle, transparent 50%, rgba(255,68,0,.3) 65%, rgba(255,34,0,.2) 80%, rgba(204,0,0,.1) 90%, transparent 100%);
      animation: explode-outer 1s ease-out forwards;
    }
    @keyframes explode{0%{transform:scale(0) rotate(0);opacity:1;filter:brightness(3)}30%{transform:scale(1.2) rotate(90deg);opacity:1;filter:brightness(2)}70%{transform:scale(2.5) rotate(180deg);opacity:.7;filter:brightness(1.5)}100%{transform:scale(4) rotate(270deg);opacity:0;filter:brightness(1)}}
    @keyframes explode-ring{0%{transform:scale(0);opacity:.8}50%{transform:scale(1.5);opacity:.6}100%{transform:scale(3);opacity:0}}
    @keyframes explode-outer{0%{transform:scale(0);opacity:.5}40%{transform:scale(1);opacity:.3}100%{transform:scale(2);opacity:0}}

    .hud{ position:absolute; top:20px; left:20px; color:#00ff88; font-size:20px; font-weight:bold;
      text-shadow:0 0 12px #00ff88, 0 0 24px rgba(0,255,136,.6), 0 0 36px rgba(0,255,136,.4); z-index:100;
      background: linear-gradient(135deg, rgba(0,30,60,.95) 0%, rgba(0,20,40,.9) 100%);
      padding: 16px 18px; border-radius: 15px; border: 3px solid rgba(0,255,136,.4);
      backdrop-filter: blur(8px); box-shadow: 0 0 20px rgba(0,255,136,.3), inset 0 0 20px rgba(0,255,136,.1); min-width: 200px;
    }
    .hud div{ margin-bottom:12px; display:flex; justify-content:space-between; align-items:center; padding:8px 12px;
      background: rgba(0,40,80,.6); border-radius:8px; border:1px solid rgba(0,255,136,.2); transition: all .3s ease;
    }
    .hud div:last-child{ margin-bottom:0 }
    .hud .stat-label{ font-size:16px; opacity:.9 }
    .hud .stat-value{ font-size:22px; font-weight:900; text-shadow:0 0 8px currentColor, 0 0 16px currentColor; }
    .score-value{ color:#ffdd00; text-shadow:0 0 8px #ffdd00, 0 0 16px rgba(255,221,0,.6) }
    .lives-value{ color:#ff4444; text-shadow:0 0 8px #ff4444, 0 0 16px rgba(255,68,68,.6) }
    .wave-value{ color:#44aaff; text-shadow:0 0 8px #44aaff, 0 0 16px rgba(68,170,255,.6) }

    .game-over{ position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); background:rgba(0,0,0,.9);
      color:#ff0000; padding:40px; border-radius:15px; text-align:center; font-size:24px; font-weight:bold;
      text-shadow:0 0 20px #ff0000; border:2px solid #ff0000; display:none; z-index:200;
    }
    .restart-btn{ background:linear-gradient(45deg,#00ff00,#00aa00); color:#000; border:none; padding:15px 30px;
      font-size:18px; font-weight:bold; border-radius:8px; cursor:pointer; margin-top:20px; transition: all .3s ease;
    }
    .restart-btn:hover{ background:linear-gradient(45deg,#00aa00,#008800); transform:scale(1.05) }

    .instructions{ position:absolute; bottom:84px; left:50%; transform:translateX(-50%); color:#00ff00; text-align:center; font-size:14px; text-shadow:0 0 5px #00ff00; z-index:50; }

    .powerup{ position:absolute; width:30px; height:30px; border-radius:50%; animation: powerup-float 2s ease-in-out infinite, powerup-glow 1.5s ease-in-out infinite alternate; z-index:50 }
    .powerup-double{ background: radial-gradient(circle,#ffff00,#ffaa00); box-shadow:0 0 15px #ffff00 }
    .powerup-rapid{ background: radial-gradient(circle,#00ff00,#00aa00); box-shadow:0 0 15px #00ff00 }
    .powerup-shield{ background: radial-gradient(circle,#00aaff,#0066cc); box-shadow:0 0 15px #00aaff }
    @keyframes powerup-float{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
    @keyframes powerup-glow{0%{box-shadow:0 0 15px currentColor}100%{box-shadow:0 0 25px currentColor,0 0 35px currentColor}}
    .player-shield{ position:absolute; width:80px; height:80px; border:3px solid #00aaff; border-radius:50%; top:-10px; left:-10px; animation: shield-pulse 1s ease-in-out infinite alternate; pointer-events:none }
    @keyframes shield-pulse{0%{opacity:.6;transform:scale(1)}100%{opacity:.9;transform:scale(1.05)}}
    .powerup-status{ position:absolute; top:20px; right:20px; color:#ffaa00; font-size:14px; font-weight:bold; text-shadow:0 0 8px #ffaa00, 0 0 15px rgba(255,170,0,.5); z-index:100 }
    .powerup-status div{ margin-bottom:8px; padding:8px 15px; background:rgba(20,10,0,.9); border-radius:8px; border:2px solid rgba(255,170,0,.4); backdrop-filter: blur(3px); animation: powerup-status-glow 2s ease-in-out infinite alternate }
    @keyframes powerup-status-glow{0%{ border-color: rgba(255,170,0,.4); box-shadow:0 0 5px rgba(255,170,0,.2)}100%{ border-color: rgba(255,170,0,.7); box-shadow:0 0 15px rgba(255,170,0,.4)}}

    /* Mobile Touch Controls (nicht im Weg, nur bei Touch sichtbar) */
    .touch-controls{ position:absolute; left:0; right:0; bottom:0; height:72px; display:flex; gap:8px; padding:8px; z-index:120; }
    .btn{ flex:1; background:rgba(0,0,0,.35); border:2px solid rgba(255,255,255,.15); color:#00ff88; border-radius:12px; font-weight:900; font-size:16px; display:flex; align-items:center; justify-content:center; user-select:none }
    .btn:active{ background:rgba(0,0,0,.55) }
    @media (hover:hover){ .touch-controls{ display:none } } /* Desktop: ausblenden */
  </style>
</head>
<body>
  <div class="game-container" id="game">
    <div class="cosmic-background"></div>
    <div class="moon"></div>
    <div class="distant-galaxies"></div>
    <div class="stars-layer-2"></div>
    <div class="stars-layer-1"></div>

    <div class="hud">
      <div><span class="stat-label">üéØ Punkte:</span><span class="stat-value score-value" id="score">0</span></div>
      <div><span class="stat-label">‚ù§Ô∏è Leben:</span><span class="stat-value lives-value" id="lives">3</span></div>
      <div><span class="stat-label">üåä Welle:</span><span class="stat-value wave-value" id="wave">1</span></div>
    </div>

    <div class="powerup-status" id="powerupStatus"></div>

    <div class="player" id="player">
      <!-- (unver√§ndert) SVG des Spielers -->
      <svg viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <linearGradient id="hullGradient" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:#e8e8e8;stop-opacity:1" />
            <stop offset="25%" style="stop-color:#d0d0d0;stop-opacity:1" />
            <stop offset="50%" style="stop-color:#a8a8a8;stop-opacity:1" />
            <stop offset="75%" style="stop-color:#808080;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#606060;stop-opacity:1" />
          </linearGradient>
          <linearGradient id="engineFlame" x1="0%" y1="0%" x2="0%" y2="100%">
            <stop offset="0%" style="stop-color:#ffffff;stop-opacity:1" />
            <stop offset="20%" style="stop-color:#00ddff;stop-opacity:1" />
            <stop offset="60%" style="stop-color:#0088ff;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#0044aa;stop-opacity:1" />
          </linearGradient>
          <radialGradient id="cockpitReflection" cx="30%" cy="30%" r="70%">
            <stop offset="0%" style="stop-color:#88ddff;stop-opacity:0.9" />
            <stop offset="40%" style="stop-color:#4499cc;stop-opacity:0.6" />
            <stop offset="100%" style="stop-color:#002244;stop-opacity:0.8" />
          </radialGradient>
          <linearGradient id="metallic" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" style="stop-color:#999999;stop-opacity:1" />
            <stop offset="50%" style="stop-color:#cccccc;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#777777;stop-opacity:1" />
          </linearGradient>
          <filter id="glow">
            <feGaussianBlur stdDeviation="2" result="coloredBlur"/>
            <feMerge><feMergeNode in="coloredBlur"/><feMergeNode in="SourceGraphic"/></feMerge>
          </filter>
        </defs>
        <path d="M30,3 L42,18 L45,35 L42,48 L35,52 L25,52 L18,48 L15,35 L18,18 Z" fill="url(#hullGradient)" stroke="#ffffff" stroke-width="1.2"/>
        <path d="M25,15 L35,15 L38,25 L35,35 L25,35 L22,25 Z" fill="url(#metallic)" stroke="#bbbbbb" stroke-width="0.8" opacity="0.8"/>
        <path d="M18,22 L8,26 L6,30 L8,34 L18,32 L20,28 L18,24 Z" fill="url(#hullGradient)" stroke="#ffffff" stroke-width="1"/>
        <path d="M42,22 L52,26 L54,30 L52,34 L42,32 L40,28 L42,24 Z" fill="url(#hullGradient)" stroke="#ffffff" stroke-width="1"/>
        <rect x="10" y="28" width="8" height="2" fill="#666666" rx="1"/>
        <rect x="42" y="28" width="8" height="2" fill="#666666" rx="1"/>
        <ellipse cx="30" cy="18" rx="9" ry="10" fill="url(#cockpitReflection)" stroke="#88ddff" stroke-width="1.5"/>
        <ellipse cx="30" cy="16" rx="6" ry="7" fill="#001133" opacity="0.9"/>
        <ellipse cx="27" cy="14" rx="2" ry="3" fill="#ffffff" opacity="0.4"/>
        <ellipse cx="33" cy="16" rx="1.5" ry="2" fill="#88ddff" opacity="0.6"/>
        <ellipse cx="26" cy="50" rx="4" ry="10" fill="url(#engineFlame)" filter="url(#glow)"/>
        <ellipse cx="34" cy="50" rx="4" ry="10" fill="url(#engineFlame)" filter="url(#glow)"/>
        <ellipse cx="26" cy="48" rx="3" ry="4" fill="#333333" stroke="#666666" stroke-width="1"/>
        <ellipse cx="34" cy="48" rx="3" ry="4" fill="#333333" stroke="#666666" stroke-width="1"/>
        <rect x="16" y="36" width="4" height="10" fill="#555555" stroke="#888888" stroke-width="1" rx="2"/>
        <rect x="40" y="36" width="4" height="10" fill="#555555" stroke="#888888" stroke-width="1" rx="2"/>
        <rect x="27" y="30" width="6" height="12" fill="#444444" stroke="#777777" stroke-width="1" rx="1"/>
        <rect x="28" y="28" width="4" height="8" fill="#666666" stroke="#999999" stroke-width="0.5" rx="0.5"/>
        <circle cx="18" cy="24" r="2" fill="#ff3333" opacity="0.9"/>
        <circle cx="42" cy="24" r="2" fill="#33ff33" opacity="0.9"/>
        <circle cx="30" cy="8" r="1.5" fill="#ffffff" opacity="0.8"/>
        <path d="M22,20 L38,20" stroke="#bbbbbb" stroke-width="0.5" opacity="0.6"/>
        <path d="M20,30 L40,30" stroke="#bbbbbb" stroke-width="0.5" opacity="0.6"/>
        <path d="M22,40 L38,40" stroke="#bbbbbb" stroke-width="0.5" opacity="0.6"/>
        <circle cx="26" cy="56" r="1" fill="#00aaff" opacity="0.7"><animate attributeName="opacity" values="0.7;0.3;0.7" dur="0.3s" repeatCount="indefinite"/></circle>
        <circle cx="34" cy="56" r="1" fill="#00aaff" opacity="0.7"><animate attributeName="opacity" values="0.3;0.7;0.3" dur="0.3s" repeatCount="indefinite"/></circle>
      </svg>
    </div>

    <div class="game-over" id="gameOver">
      <div>SPIEL VORBEI!</div>
      <div style="font-size: 18px; margin: 15px 0;">Endpunktzahl: <span id="finalScore">0</span></div>
      <button class="restart-btn" id="restartBtn">Neues Spiel</button>
    </div>

    <div class="instructions">Pfeiltasten/Buttons bewegen ‚Ä¢ Leertaste/‚ö° schie√üen</div>

    <!-- Touch Controls -->
    <div class="touch-controls" id="controls">
      <div class="btn" id="leftBtn">‚¨ÖÔ∏é</div>
      <div class="btn" id="shootBtn">‚ö°</div>
      <div class="btn" id="rightBtn">‚û°Ô∏é</div>
    </div>
  </div>

  <script>
    // PWA: Service Worker Registration
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js').catch(console.warn);
      });
    }

    const gameContainer = document.querySelector('.game-container');
    const player = document.getElementById('player');
    const scoreElement = document.getElementById('score');
    const livesElement = document.getElementById('lives');
    const waveElement = document.getElementById('wave');
    const gameOverElement = document.getElementById('gameOver');
    const finalScoreElement = document.getElementById('finalScore');
    const restartBtn = document.getElementById('restartBtn');

    let gameState = {
      playerX: window.innerWidth / 2 - 30,
      score: 0,
      lives: 3,
      wave: 1,
      gameRunning: true,
      bullets: [], enemies: [], enemyBullets: [], powerups: [],
      keys: {}, lastShot: 0, enemySpawnTimer: 0, waveEnemiesLeft: 5, powerupSpawnTimer: 0,
      doubleShot: false, doubleShotTimer: 0,
      rapidFire: false, rapidFireTimer: 0,
      shield: false, shieldTimer: 0, shieldElement: null
    };

    // Inputs
    document.addEventListener('keydown', (e) => { gameState.keys[e.code] = true; });
    document.addEventListener('keyup', (e) => { gameState.keys[e.code] = false; });

    // Touch buttons
    const leftBtn = document.getElementById('leftBtn');
    const rightBtn = document.getElementById('rightBtn');
    const shootBtn = document.getElementById('shootBtn');

    function bindTouch(el, onDown, onUp){
      const start = () => onDown();
      const end = () => onUp();
      el.addEventListener('touchstart', start);
      el.addEventListener('touchend', end);
      el.addEventListener('touchcancel', end);
      el.addEventListener('mousedown', start);
      el.addEventListener('mouseup', end);
      el.addEventListener('mouseleave', end);
    }
    bindTouch(leftBtn, () => gameState.keys['ArrowLeft'] = true, () => gameState.keys['ArrowLeft'] = false);
    bindTouch(rightBtn, () => gameState.keys['ArrowRight'] = true, () => gameState.keys['ArrowRight'] = false);
    bindTouch(shootBtn, () => gameState.keys['Space'] = true, () => gameState.keys['Space'] = false);

    // Resize safety
    window.addEventListener('resize', () => {
      if (gameState.playerX > window.innerWidth - 60) {
        gameState.playerX = Math.max(0, window.innerWidth - 60);
      }
      player.style.left = gameState.playerX + 'px';
    });

    function movePlayer() {
      if (gameState.keys['ArrowLeft'] && gameState.playerX > 0) gameState.playerX -= 8;
      if (gameState.keys['ArrowRight'] && gameState.playerX < window.innerWidth - 60) gameState.playerX += 8;
      player.style.left = gameState.playerX + 'px';
    }

    function shoot() {
      const fireRate = gameState.rapidFire ? 100 : 200;
      if (gameState.keys['Space'] && Date.now() - gameState.lastShot > fireRate) {
        const bullets = [];
        if (gameState.doubleShot) {
          bullets.push(gameState.playerX + 20, gameState.playerX + 36);
        } else {
          bullets.push(gameState.playerX + 28);
        }
        for (const bx of bullets) {
          const bullet = document.createElement('div');
          bullet.className = 'bullet';
          bullet.style.left = bx + 'px';
          bullet.style.bottom = '110px';
          gameContainer.appendChild(bullet);
          gameState.bullets.push({ element: bullet, x: bx, y: window.innerHeight - 110 });
        }
        gameState.lastShot = Date.now();
      }
    }

    function createEnemy() {
      const enemyTypes = ['fighter','scout','cruiser'];
      let type = enemyTypes[Math.floor(Math.random() * enemyTypes.length)];
      if (gameState.wave % 5 === 0 && Math.random() < 0.3) type = 'boss';

      const enemy = document.createElement('div'); enemy.className = 'enemy';
      let width, height, hp, speed, fireRate, points;
      switch(type){
        case 'scout': width=height=35; hp=1; speed=4; fireRate=2000; points=150; break;
        case 'cruiser': width=height=65; hp=3; speed=1; fireRate=1000; points=300; break;
        case 'boss': width=height=80; hp=8; speed=.5; fireRate=800; points=1000; break;
        default: width=height=50; hp=2; speed=2; fireRate=1500; points=100;
      }
      enemy.style.width = width + 'px'; enemy.style.height = height + 'px';
      const x = Math.random() * (window.innerWidth - width);
      enemy.style.left = x + 'px'; enemy.style.top = '0px';
      const timestamp = Date.now();
      switch(type){
        case 'scout':
          enemy.innerHTML = \`
          <svg viewBox="0 0 35 35" xmlns="http://www.w3.org/2000/svg">
            <defs><linearGradient id="scoutGradient\${timestamp}" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" style="stop-color:#00ff88"/><stop offset="50%" style="stop-color:#00cc66"/>
              <stop offset="100%" style="stop-color:#008844"/></linearGradient></defs>
            <ellipse cx="17.5" cy="17.5" rx="5" ry="12" fill="url(#scoutGradient\${timestamp})" stroke="#ffffff" stroke-width="1"/>
            <polygon points="12.5,20 7,25 12.5,22" fill="#666" stroke="#fff" stroke-width="1"/>
            <polygon points="22.5,20 28,25 22.5,22" fill="#666" stroke="#fff" stroke-width="1"/>
            <ellipse cx="17.5" cy="12" rx="3" ry="4" fill="#001100" stroke="#00ff88" stroke-width="1"/>
            <rect x="15.5" y="27" width="4" height="6" fill="#00ff88" rx="2"/>
            <circle cx="17.5" cy="8" r="1" fill="#00ff88"/>
          </svg>\`; break;
        case 'cruiser':
          enemy.innerHTML = \`
          <svg viewBox="0 0 65 65" xmlns="http://www.w3.org/2000/svg">
            <defs><linearGradient id="cruiserGradient\${timestamp}" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" style="stop-color:#8844ff"/><stop offset="50%" style="stop-color:#6622cc"/>
              <stop offset="100%" style="stop-color:#441188"/></linearGradient></defs>
            <ellipse cx="32.5" cy="32.5" rx="12" ry="20" fill="url(#cruiserGradient\${timestamp})" stroke="#ffffff" stroke-width="2"/>
            <polygon points="20.5,25 5,20 20.5,35" fill="#333" stroke="#fff" stroke-width="1"/>
            <polygon points="44.5,25 60,20 44.5,35" fill="#333" stroke="#fff" stroke-width="1"/>
            <ellipse cx="32.5" cy="20" rx="8" ry="10" fill="#220044" stroke="#8844ff" stroke-width="2"/>
            <ellipse cx="32.5" cy="20" rx="5" ry="7" fill="#440088" opacity="0.8"/>
            <rect x="27.5" y="48" width="4" height="10" fill="#8844ff" rx="2"/>
            <rect x="33.5" y="48" width="4" height="10" fill="#8844ff" rx="2"/>
            <rect x="30.5" y="35" width="4" height="8" fill="#ffffff" opacity="0.6"/>
            <circle cx="32.5" cy="12" r="2" fill="#8844ff"/>
          </svg>\`; break;
        case 'boss':
          enemy.innerHTML = \`
          <svg viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg">
            <defs>
              <linearGradient id="bossGradient\${timestamp}" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" style="stop-color:#ff0088"/><stop offset="50%" style="stop-color:#cc0066"/>
                <stop offset="100%" style="stop-color:#880044"/></linearGradient>
              <filter id="bossGlow\${timestamp}"><feGaussianBlur stdDeviation="3" result="b"/>
                <feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
            </defs>
            <ellipse cx="40" cy="40" rx="15" ry="25" fill="url(#bossGradient\${timestamp})" stroke="#ffffff" stroke-width="2" filter="url(#bossGlow\${timestamp})"/>
            <polygon points="25,30 0,25 25,45" fill="#222" stroke="#fff" stroke-width="2"/>
            <polygon points="55,30 80,25 55,45" fill="#222" stroke="#fff" stroke-width="2"/>
            <ellipse cx="40" cy="25" rx="10" ry="12" fill="#440022" stroke="#ff0088" stroke-width="2"/>
            <ellipse cx="40" cy="25" rx="7" ry="9" fill="#660044" opacity="0.8"/>
            <rect x="32" y="60" width="5" height="12" fill="#ff0088" rx="2"/>
            <rect x="38" y="60" width="5" height="12" fill="#ff0088" rx="2"/>
            <rect x="44" y="60" width="5" height="12" fill="#ff0088" rx="2"/>
            <rect x="36" y="45" width="3" height="10" fill="#fff" opacity="0.8"/>
            <rect x="41" y="45" width="3" height="10" fill="#fff" opacity="0.8"/>
            <circle cx="40" cy="15" r="3" fill="#ff0088"/>
            <circle cx="40" cy="15" r="1.5" fill="#ffffff"/>
          </svg>\`; break;
        default:
          enemy.innerHTML = \`
          <svg viewBox="0 0 50 50" xmlns="http://www.w3.org/2000/svg">
            <defs><linearGradient id="fighterGradient\${timestamp}" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" style="stop-color:#ff4444"/><stop offset="50%" style="stop-color:#cc0000"/>
              <stop offset="100%" style="stop-color:#660000"/></linearGradient></defs>
            <ellipse cx="25" cy="25" rx="8" ry="15" fill="url(#fighterGradient\${timestamp})" stroke="#ffffff" stroke-width="1"/>
            <polygon points="17,20 5,15 17,25" fill="#444" stroke="#fff" stroke-width="1"/>
            <polygon points="33,20 45,15 33,25" fill="#444" stroke="#fff" stroke-width="1"/>
            <ellipse cx="25" cy="15" rx="4" ry="6" fill="#330000" stroke="#ff0000" stroke-width="1"/>
            <ellipse cx="25" cy="15" rx="2" ry="4" fill="#660000" opacity="0.8"/>
            <rect x="22" y="35" width="6" height="8" fill="#ff6600" rx="3"/>
            <rect x="23" y="28" width="4" height="4" fill="#ffffff" opacity="0.4"/>
            <circle cx="25" cy="10" r="1" fill="#ff0000"/>
          </svg>\`;
      }
      gameContainer.appendChild(enemy);
      gameState.enemies.push({ element: enemy, x: x, y: 0, lastShot: Date.now(), type, hp, maxHp: hp, speed, fireRate, points, width, height });
    }

    function createPowerup(){
      const powerupTypes = ['double','rapid','shield'];
      const type = powerupTypes[Math.floor(Math.random()*powerupTypes.length)];
      const powerup = document.createElement('div'); powerup.className = \`powerup powerup-\${type}\`;
      const x = Math.random() * (window.innerWidth - 30);
      powerup.style.left = x + 'px'; powerup.style.top = '0px';
      let symbolHTML = '';
      if(type==='double'){ symbolHTML = `<svg viewBox="0 0 30 30" xmlns="http://www.w3.org/2000/svg" style="width:100%;height:100%;"><defs><radialGradient id="doubleGlow" cx="50%" cy="50%" r="50%"><stop offset="0%" style="stop-color:#ffff88"/><stop offset="70%" style="stop-color:#ffaa00"/><stop offset="100%" style="stop-color:#ff6600;stop-opacity:0.8"/></radialGradient></defs><polygon points="8,5 12,15 10,15 14,25 10,20 6,20" fill="url(#doubleGlow)" stroke="#ffffff" stroke-width="1"/><polygon points="16,5 20,15 18,15 22,25 18,20 14,20" fill="url(#doubleGlow)" stroke="#ffffff" stroke-width="1"/><circle cx="15" cy="15" r="12" fill="none" stroke="#ffaa00" stroke-width="2" opacity="0.6"/></svg>`; }
      if(type==='rapid'){ symbolHTML = `<svg viewBox="0 0 30 30" xmlns="http://www.w3.org/2000/svg" style="width:100%;height:100%;"><defs><radialGradient id="rapidGlow" cx="50%" cy="50%" r="50%"><stop offset="0%" style="stop-color:#88ff88"/><stop offset="70%" style="stop-color:#00aa00"/><stop offset="100%" style="stop-color:#006600;stop-opacity:0.8"/></radialGradient></defs><polygon points="15,3 18,8 12,8" fill="url(#rapidGlow)" stroke="#ffffff" stroke-width="1"/><polygon points="15,8 18,13 12,13" fill="url(#rapidGlow)" stroke="#ffffff" stroke-width="1"/><polygon points="15,13 18,18 12,18" fill="url(#rapidGlow)" stroke="#ffffff" stroke-width="1"/><polygon points="15,18 18,23 12,23" fill="url(#rapidGlow)" stroke="#ffffff" stroke-width="1"/><circle cx="15" cy="15" r="12" fill="none" stroke="#00aa00" stroke-width="2" opacity="0.6"/></svg>`; }
      if(type==='shield'){ symbolHTML = `<svg viewBox="0 0 30 30" xmlns="http://www.w3.org/2000/svg" style="width:100%;height:100%;"><defs><radialGradient id="shieldGlow" cx="50%" cy="50%" r="50%"><stop offset="0%" style="stop-color:#88aaff"/><stop offset="70%" style="stop-color:#0066cc"/><stop offset="100%" style="stop-color:#003388;stop-opacity:0.8"/></radialGradient></defs><path d="M15,3 L25,8 L25,18 L15,27 L5,18 L5,8 Z" fill="url(#shieldGlow)" stroke="#ffffff" stroke-width="2"/><path d="M15,6 L22,10 L22,17 L15,24 L8,17 L8,10 Z" fill="none" stroke="#88aaff" stroke-width="1.5" opacity="0.8"/><circle cx="15" cy="15" r="3" fill="#ffffff" opacity="0.9"/></svg>`; }
      powerup.innerHTML = symbolHTML;
      gameContainer.appendChild(powerup);
      gameState.powerups.push({ element: powerup, x, y: 0, type });
    }

    function activatePowerup(type){
      const duration = 10000;
      if(type==='double'){ gameState.doubleShot = true; gameState.doubleShotTimer = Date.now()+duration; }
      if(type==='rapid'){ gameState.rapidFire = true; gameState.rapidFireTimer = Date.now()+duration; }
      if(type==='shield'){
        if(!gameState.shield){
          gameState.shield = true; gameState.shieldTimer = Date.now()+duration;
          const shield = document.createElement('div'); shield.className='player-shield'; player.appendChild(shield); gameState.shieldElement = shield;
        } else { gameState.shieldTimer = Date.now()+duration; }
      }
      updatePowerupStatus();
    }

    function updatePowerupStatus(){
      const el = document.getElementById('powerupStatus');
      let html = '';
      if(gameState.doubleShot){ html += `<div>‚ö°‚ö° Doppelschuss: ${Math.max(0,Math.ceil((gameState.doubleShotTimer-Date.now())/1000))}s</div>`; }
      if(gameState.rapidFire){ html += `<div>‚ñ≤‚ñ≤‚ñ≤ Schnellfeuer: ${Math.max(0,Math.ceil((gameState.rapidFireTimer-Date.now())/1000))}s</div>`; }
      if(gameState.shield){ html += `<div>‚óÜ Schild: ${Math.max(0,Math.ceil((gameState.shieldTimer-Date.now())/1000))}s</div>`; }
      el.innerHTML = html;
    }

    function enemyShoot(enemy){
      if (Date.now() - enemy.lastShot > enemy.fireRate + Math.random()*500) {
        const centerX = enemy.x + enemy.width/2;
        const spawn = (x)=>{
          const bullet = document.createElement('div'); bullet.className='enemy-bullet';
          bullet.style.left = (x - 2) + 'px'; bullet.style.top = (enemy.y + enemy.height) + 'px';
          gameContainer.appendChild(bullet); gameState.enemyBullets.push({ element: bullet, x, y: enemy.y + enemy.height });
        }
        if (enemy.type === 'boss'){ for(let i=-1;i<=1;i++) spawn(centerX + i*15); }
        else if (enemy.type === 'cruiser'){ spawn(centerX - 10); spawn(centerX + 10); }
        else { spawn(centerX); }
        enemy.lastShot = Date.now();
      }
    }

    function createExplosion(x, y, size='normal'){
      const explosion = document.createElement('div'); explosion.className = 'explosion';
      let px = 80; if(size==='small') px=50; if(size==='large') px=120; if(size==='boss') px=150;
      Object.assign(explosion.style,{ width: px+'px', height: px+'px', left: (x-px/2)+'px', top: (y-px/2)+'px', transform: \`rotate(\${Math.random()*360}deg)\` });
      gameContainer.appendChild(explosion);
      if(size==='large' || size==='boss'){
        setTimeout(()=>{
          for(let i=0;i<3;i++){
            const s = document.createElement('div'); s.className='explosion'; s.style.width='40px'; s.style.height='40px';
            const ox=(Math.random()-0.5)*60, oy=(Math.random()-0.5)*60;
            s.style.left=(x+ox-20)+'px'; s.style.top=(y+oy-20)+'px'; s.style.transform=\`rotate(\${Math.random()*360}deg)\`;
            gameContainer.appendChild(s); setTimeout(()=>{ s.remove(); },800);
          }
        },200);
      }
      setTimeout(()=>{ explosion.remove(); },800);
    }

    function checkCollisions(){
      // Player bullets vs enemies
      gameState.bullets.slice().forEach((bullet) => {
        gameState.enemies.slice().forEach((enemy) => {
          if (bullet.x > enemy.x && bullet.x < enemy.x + enemy.width && bullet.y > enemy.y && bullet.y < enemy.y + enemy.height){
            bullet.element.remove(); gameState.bullets = gameState.bullets.filter(b => b !== bullet);
            enemy.hp--; createExplosion(bullet.x, bullet.y, 'small');
            if (enemy.hp <= 0){
              const size = enemy.type==='cruiser' ? 'large' : enemy.type==='boss' ? 'boss' : 'normal';
              createExplosion(enemy.x + enemy.width/2, enemy.y + enemy.height/2, size);
              enemy.element.remove(); gameState.enemies = gameState.enemies.filter(e => e !== enemy);
              gameState.score += enemy.points; scoreElement.textContent = gameState.score; gameState.waveEnemiesLeft--;
            } else {
              enemy.element.style.filter='brightness(2)'; setTimeout(()=>{ if(enemy.element) enemy.element.style.filter='brightness(1)'; },100);
            }
          }
        });
      });

      // Enemy bullets vs player
      gameState.enemyBullets.slice().forEach((bullet) => {
        if (bullet.x > gameState.playerX && bullet.x < gameState.playerX + 60 && bullet.y > window.innerHeight - 110 && bullet.y < window.innerHeight - 50){
          bullet.element.remove(); gameState.enemyBullets = gameState.enemyBullets.filter(b => b !== bullet);
          if (!gameState.shield){
            createExplosion(gameState.playerX + 30, window.innerHeight - 80, 'normal');
            gameState.lives--; livesElement.textContent = gameState.lives;
            if (gameState.lives <= 0) gameOver();
          }
        }
      });

      // Enemies vs player
      gameState.enemies.slice().forEach((enemy) => {
        if (enemy.x < gameState.playerX + 60 && enemy.x + enemy.width > gameState.playerX && enemy.y < window.innerHeight - 50 && enemy.y + enemy.height > window.innerHeight - 110){
          const size = enemy.type==='cruiser' ? 'large' : enemy.type==='boss' ? 'boss' : 'normal';
          createExplosion(enemy.x + enemy.width/2, enemy.y + enemy.height/2, size);
          enemy.element.remove(); gameState.enemies = gameState.enemies.filter(e => e !== enemy);
          if (!gameState.shield){
            createExplosion(gameState.playerX + 30, window.innerHeight - 80, 'normal');
            gameState.lives--; livesElement.textContent = gameState.lives;
            if (gameState.lives <= 0) gameOver();
          }
        }
      });

      // Powerups vs player
      gameState.powerups.slice().forEach((powerup) => {
        if (powerup.x < gameState.playerX + 60 && powerup.x + 30 > gameState.playerX && powerup.y < window.innerHeight - 50 && powerup.y + 30 > window.innerHeight - 110){
          activatePowerup(powerup.type);
          powerup.element.remove(); gameState.powerups = gameState.powerups.filter(p => p !== powerup);
          gameState.score += 50; scoreElement.textContent = gameState.score;
        }
      });
    }

    function updateGame(){
      if (!gameState.gameRunning) return;
      // player bullets
      gameState.bullets.slice().forEach((bullet) => {
        bullet.y -= 12; bullet.element.style.bottom = (window.innerHeight - bullet.y) + 'px';
        if (bullet.y < 0){ bullet.element.remove(); gameState.bullets = gameState.bullets.filter(b => b !== bullet); }
      });
      // enemy bullets
      gameState.enemyBullets.slice().forEach((bullet) => {
        bullet.y += 8; bullet.element.style.top = bullet.y + 'px';
        if (bullet.y > window.innerHeight){ bullet.element.remove(); gameState.enemyBullets = gameState.enemyBullets.filter(b => b !== bullet); }
      });
      // enemies
      gameState.enemies.forEach((enemy) => {
        enemy.y += enemy.speed; enemy.element.style.top = enemy.y + 'px'; enemyShoot(enemy);
        if (enemy.y > window.innerHeight){ enemy.element.remove(); gameState.enemies = gameState.enemies.filter(e => e !== enemy); gameState.waveEnemiesLeft--; }
      });
      // powerups
      gameState.powerups.forEach((p) => { p.y += 3; p.element.style.top = p.y + 'px'; if (p.y > window.innerHeight){ p.element.remove(); gameState.powerups = gameState.powerups.filter(pp=>pp!==p);} });
      // spawns
      if (gameState.waveEnemiesLeft > 0 && Date.now() - gameState.enemySpawnTimer > 2000){ createEnemy(); gameState.enemySpawnTimer = Date.now(); }
      if (Date.now() - gameState.powerupSpawnTimer > 15000){ createPowerup(); gameState.powerupSpawnTimer = Date.now(); }
      // powerup timers
      if (gameState.doubleShot && Date.now() > gameState.doubleShotTimer) gameState.doubleShot = false;
      if (gameState.rapidFire && Date.now() > gameState.rapidFireTimer) gameState.rapidFire = false;
      if (gameState.shield && Date.now() > gameState.shieldTimer){ gameState.shield = false; if (gameState.shieldElement){ gameState.shieldElement.remove(); gameState.shieldElement = null; } }
      updatePowerupStatus();
      // next wave
      if (gameState.waveEnemiesLeft <= 0 && gameState.enemies.length === 0){ gameState.wave++; gameState.waveEnemiesLeft = 5 + gameState.wave * 2; waveElement.textContent = gameState.wave; }
      checkCollisions();
    }

    function gameOver(){
      gameState.gameRunning = false; finalScoreElement.textContent = gameState.score; gameOverElement.style.display = 'block';
    }
    function restartGame(){
      document.querySelectorAll('.bullet, .enemy-bullet, .enemy, .explosion, .powerup, .player-shield').forEach(el => el.remove());
      gameState = { playerX: window.innerWidth / 2 - 30, score: 0, lives: 3, wave: 1, gameRunning: true, bullets: [], enemies: [], enemyBullets: [], powerups: [], keys: {}, lastShot: 0, enemySpawnTimer: 0, waveEnemiesLeft: 3, powerupSpawnTimer: 0, doubleShot: false, doubleShotTimer: 0, rapidFire: false, rapidFireTimer: 0, shield: false, shieldTimer: 0, shieldElement: null };
      scoreElement.textContent='0'; livesElement.textContent='3'; waveElement.textContent='1'; gameOverElement.style.display='none'; document.getElementById('powerupStatus').innerHTML=''; player.style.left = gameState.playerX + 'px';
    }
    restartBtn.addEventListener('click', restartGame);

    function gameLoop(){ if (gameState.gameRunning){ movePlayer(); shoot(); updateGame(); } requestAnimationFrame(gameLoop); }
    gameLoop();
  </script>
</body>
</html>
